{
  "builders": [
    {
      "type": "lxd",
      "name": "debian-11-apache",
      "image": "images:debian/11",
      "output_image": "debian-web-server",
      "publish_properties": {
        "description": "Debian 11 with vulnerable Apache 2.4.49"
      }
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "apache2.service",
      "destination": "/tmp/apache2.service"
    },
    {
      "type": "shell",
      "inline": [
        "echo 'updating apt-get'",
        "apt-get update -y",
        "apt-get install build-essential libapr1-dev libaprutil1-dev libpcre3-dev wget curl sudo systemd -y",
        "wget https://archive.apache.org/dist/httpd/httpd-2.4.49.tar.gz",
        "tar -xzvf httpd-2.4.49.tar.gz",
        "cd httpd-2.4.49",
        "./configure --prefix=/usr/local/apache2",
        "make",
        "make install",
        "mv /tmp/apache2.service /etc/systemd/system/apache2.service",
        "sed -i 's/^#LoadModule cgid_module modules\\/mod_cgid\\.so/LoadModule cgid_module modules\\/mod_cgid.so/' /usr/local/apache2/conf/httpd.conf",
        "sed -i 's/Require all denied/Require all granted/g' /usr/local/apache2/conf/httpd.conf",
        "systemctl daemon-reload",
        "systemctl enable apache2",
        "systemctl start apache2",
        "curl http://localhost",
        "chmod u+s /usr/bin/date",
        "echo 'vrnctf{simple_suid_task}' > /root/flag.txt"
      ]
    }
  ],
  "post-processors": [
    {
      "type": "manifest",
      "output": "manifest.json",
      "strip_path": true
    }
  ]
}