<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta
          name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />
  <title>User Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-black text-white h-screen flex flex-col">

<div class="flex items-center p-4 gap-4 sticky top-0 z-50 bg-gray-900">
  <img src="/assets/logo.png" class="w-8"/>
  <p class="font-semibold text-lg">TIVAN GROUP</p>
  <a href="/" class="hover:underline ml-8">Главная</a>
  <a href="/login.html" class="hover:underline">Войти</a>
</div>

<div class="flex flex-col h-full justify-center items-center p-8">

  <div class="flex flex-col p-8 gap-4 rounded-lg bg-gray-900 border-white border-opacity-10 border-[1px]">
    <img src="/assets/logo.png" class="mx-auto w-24 animate-pulse"/>
    <h3 class="text-center text-lg font-semibold">Войти</h3>
    <div class="loginError"></div>
    <form id="loginForm" class="flex flex-col gap-2">
      <input
              type="email"
              class="rounded p-2 bg-gray-800 border-white border-opacity-10 border-[1px] focus:border-opacity-60 focus:outline-none"

              name="email"
              placeholder="Email"
              required
      />
      <input
              type="password"
              class="rounded p-2 bg-gray-800 border-white border-opacity-10 border-[1px] focus:border-opacity-60 focus:outline-none"

              name="password"
              placeholder="Пароль"
              required
      />
      <button type="submit" class="bg-[#948343] px-3 py-1.5 rounded">
        Войти
      </button>
      <div class="flex items-center justify-end gap-2 text-sm">
        <p class="text-gray-400">Еще нет аккаунта?</p>
        <a href="/register.html" class="hover:underline">Регистрация</a>
      </div>
    </form>
  </div>
</div>

<script type="text/javascript">
  document.getElementById("loginForm").addEventListener("submit", async function (event) {
    event.preventDefault();

    const errorDiv = document.querySelector(".loginError");
    errorDiv.innerHTML = "";

    const formData = {
      email: this.elements.email.value,
      password: this.elements.password.value
    };

    try {
      const response = await fetch("/api/login", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(formData)
      });

      if (!response.ok)
        throw new Error("auth")

      const text = await response.text();

      if (text === "user") {
        window.location.replace("/dashboard/user");
      } else if (text === "admin") {
        window.location.replace("/dashboard/admin");
      }
      this.reset();
    } catch (error) {
      // Add error message to the loginError div
      errorDiv.innerHTML = `<div class="p-2 bg-red-600 rounded">Неверный логин или пароль</div>`;
    }
  });
</script>

</body>
</html>